<h1>Homework 6-2 </h1> <br>
<br>
<br>

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.


<h4>Решение</h4>

Для реализации API Gateway, соответствующего требованиям, можно рассмотреть несколько популярных решений: Amazon API Gateway, Kong, NGINX и KrakenD.

Вот сравнительная таблица возможностей:

\ | Маршрутизация | Аутентификация | HTTPS терминация
|---|---|---|---|
Amazon API Gateway | Да | Да | Да
Kong | Да | Да | Да
NGINX | Да | Да | Да
KrakenD | Да | Да | Да

Выбор решения: NGINX т.к. он является мощным и гибким решением для реализации API Gateway, которое соответствует всем необходимым требованиям и предлагает дополнительные преимущества, такие как высокая производительность и возможность настройки.

Выбор NGINX в качестве решения для API Gateway можно обосновать следующими преимуществами:

- Высокая производительность: NGINX известен своей способностью обрабатывать большое количество одновременных соединений с низким потреблением ресурсов. Это делает его идеальным для высоконагруженных приложений.

- Гибкость и настраиваемость: NGINX предоставляет мощные возможности конфигурации, позволяя настраивать маршрутизацию запросов, правила обработки и другие параметры в соответствии с конкретными требованиями вашего приложения.

- Поддержка различных протоколов: NGINX поддерживает как HTTP/HTTPS, так и другие протоколы, что позволяет использовать его в различных сценариях, включая WebSocket и gRPC.

- Терминация HTTPS: NGINX может обрабатывать SSL/TLS-соединения, обеспечивая безопасную передачу данных. Это позволяет разгрузить бэкенд-сервисы от обработки шифрования.

- Аутентификация и авторизация: NGINX поддерживает различные механизмы аутентификации, включая Basic Auth, JWT и OAuth2 через сторонние модули. Это позволяет легко интегрировать проверку аутентификационной информации в запросах.

- Масштабируемость: NGINX легко масштабируется, что позволяет добавлять новые экземпляры по мере роста нагрузки. Это особенно важно для микросервисной архитектуры.

- Сообщество и поддержка: NGINX имеет большое сообщество и множество ресурсов, что облегчает поиск решений для возникающих проблем и получение поддержки.

- Open Source: NGINX доступен как в бесплатной версии, так и в коммерческой (NGINX Plus), что позволяет выбрать подходящий вариант в зависимости от бюджета и потребностей.

- Логирование и мониторинг: NGINX предоставляет возможности для детального логирования и мониторинга, что позволяет отслеживать производительность и выявлять проблемы.


## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

<h4>Решение</h4>

Для выбора подходящего брокера сообщений, соответствующего требованиям, рассмотрим три популярных решения: Apache Kafka, RabbitMQ и ActiveMQ.

Вот сравнительная таблица возможностей:

Возможности | Apache Kafka | RabbitMQ | ActiveMQ
|---|---|---|---|
Поддержка кластеризации | Да | Да | Да
Хранение сообщений на диске | Да | Да | Да
Высокая скорость работы | Да | Средняя | Средняя
Поддержка различных форматов сообщений | Да (JSON, Avro, Protobuf и др.) | Да (JSON, XML, и др.) | Да (JSON, XML, и др.)
Разделение прав доступа | Да | Да | Да
Простота эксплуатации | Средняя | Высокая | Средняя

## Задача 3: API Gateway * (необязательная)

### Есть три сервиса:

**minio**
- хранит загруженные файлы в бакете images,
- S3 протокол,

**uploader**
- принимает файл, если картинка сжимает и загружает его в minio,
- POST /v1/upload,

**security**
- регистрация пользователя POST /v1/user,
- получение информации о пользователе GET /v1/user,
- логин пользователя POST /v1/token,
- проверка токена GET /v1/token/validation.


### Необходимо воспользоваться любым балансировщиком и сделать API Gateway:

**POST /v1/register**
1. Анонимный доступ.
2. Запрос направляется в сервис security POST /v1/user.

**POST /v1/token**
1. Анонимный доступ.
2. Запрос направляется в сервис security POST /v1/token.

**GET /v1/user**
1. Проверка токена. Токен ожидается в заголовке Authorization. Токен проверяется через вызов сервиса security GET /v1/token/validation/.
2. Запрос направляется в сервис security GET /v1/user.

**POST /v1/upload**
1. Проверка токена. Токен ожидается в заголовке Authorization. Токен проверяется через вызов сервиса security GET /v1/token/validation/.
2. Запрос направляется в сервис uploader POST /v1/upload.

**GET /v1/user/{image}**
1. Проверка токена. Токен ожидается в заголовке Authorization. Токен проверяется через вызов сервиса security GET /v1/token/validation/.
2. Запрос направляется в сервис minio GET /images/{image}.

### Ожидаемый результат

Результатом выполнения задачи должен быть docker compose файл, запустив который можно локально выполнить следующие команды с успешным результатом.
Предполагается, что для реализации API Gateway будет написан конфиг для NGinx или другого балансировщика нагрузки, который будет запущен как сервис через docker-compose и будет обеспечивать балансировку и проверку аутентификации входящих запросов.
Авторизация
curl -X POST -H 'Content-Type: application/json' -d '{"login":"bob", "password":"qwe123"}' http://localhost/token

**Загрузка файла**

curl -X POST -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJib2IifQ.hiMVLmssoTsy1MqbmIoviDeFPvo-nCd92d4UFiN2O2I' -H 'Content-Type: octet/stream' --data-binary @yourfilename.jpg http://localhost/upload

**Получение файла**
curl -X GET http://localhost/images/4e6df220-295e-4231-82bc-45e4b1484430.jpg

---

#### [Дополнительные материалы: как запускать, как тестировать, как проверить](https://github.com/netology-code/devkub-homeworks/tree/main/11-microservices-02-principles)

---

